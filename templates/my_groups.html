<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Groups</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
    <style>
        body { background:#020b1f; color:#fff; font-family: Arial, sans-serif; }
        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        .panel { background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.1); border-radius:12px; padding:20px; margin-bottom:20px; }
        .group-list a { display:block; color:#7eb2ff; text-decoration:none; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.07); }
        .group-list a:last-child { border-bottom:none; }
        .row { display:flex; gap:10px; flex-wrap:wrap; }
        input { flex:1; min-width: 180px; padding:10px; border-radius:8px; border:1px solid #234; background:#061633; color:#fff; }
        button { padding:10px 14px; border:0; border-radius:8px; background:#2d7dff; color:#fff; cursor:pointer; }
        #msg { margin-top:10px; color:#9ed0ff; }
    </style>
</head>
<body>
<nav class="site-nav">
    <a href="/" class="nav-logo">ğŸ€ MM Bracket</a>
    <div class="nav-links">
        <a href="/"><span class="nav-icon">ğŸ </span><span class="nav-label">Home</span></a>
        <a href="/bracket"><span class="nav-icon">âš¡</span><span class="nav-label">Fill Bracket</span></a>
        {% if current_user.is_authenticated %}
        <a href="/my_brackets"><span class="nav-icon">ğŸ“‹</span><span class="nav-label">My Brackets</span></a>
        <a href="/my_groups"><span class="nav-icon">ğŸ‘¥</span><span class="nav-label">My Groups</span></a>
        {% endif %}
        <span class="nav-divider"></span>
        <a href="/leaderboard"><span class="nav-icon">ğŸ†</span><span class="nav-label">Leaderboard</span></a>
        <a href="/rankings_stats"><span class="nav-icon">ğŸ“Š</span><span class="nav-label">Rankings & Stats</span></a>
        <span class="nav-divider"></span>
        <a href="/help" class="active"><span class="nav-icon">â“</span><span class="nav-label">Help</span></a>
        <a href="/contact"><span class="nav-icon">âœ‰ï¸</span><span class="nav-label">Contact</span></a>
        <span class="nav-divider"></span>
        {% if current_user.is_authenticated %}
        <a href="/logout" class="btn-danger"><span class="nav-icon">ğŸšª</span><span class="nav-label">Logout</span></a>
        {% else %}
        <a href="/login"><span class="nav-icon">ğŸ”‘</span><span class="nav-label">Login</span></a>
        {% endif %}
    </div>
</nav>

<div class="container">
    <h1>My Groups</h1>

    <div class="panel">
        <h3>Your Groups</h3>
        {% if groups_data %}
            {% for gd in groups_data %}
            <div style="border-bottom:1px solid rgba(255,255,255,0.07); padding:14px 0;">
                <a href="/groups/{{ gd.group.id }}" style="font-size:17px; font-weight:700; color:#7eb2ff; text-decoration:none;">
                    {{ gd.group.name }}
                </a>
                <span style="font-size:12px; color:rgba(255,255,255,0.35); margin-left:10px;">
                    {{ gd.total_entries }} entr{{ 'y' if gd.total_entries == 1 else 'ies' }}
                </span>
                {% if gd.my_entries %}
                    <table style="margin-top:8px; width:100%; border-collapse:collapse; font-size:13px;">
                        <thead>
                            <tr>
                                <th style="text-align:left; padding:4px 8px; color:rgba(255,255,255,0.45); font-weight:600;">Bracket</th>
                                <th style="text-align:center; padding:4px 8px; color:rgba(255,255,255,0.45); font-weight:600;">Score</th>
                                <th style="text-align:center; padding:4px 8px; color:rgba(255,255,255,0.45); font-weight:600;">Rank</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bracket, rank in gd.my_entries %}
                            <tr>
                                <td style="padding:4px 8px;">
                                    <a href="/bracket/{{ bracket.id }}" style="color:#a8c8ff; text-decoration:none;">{{ bracket.bracket_name }}</a>
                                </td>
                                <td style="text-align:center; padding:4px 8px; color:#f0d060; font-weight:700;">{{ bracket.score }}</td>
                                <td style="text-align:center; padding:4px 8px; color:#86c988; font-weight:700;">#{{ rank }} / {{ gd.total_entries }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div style="font-size:13px; color:rgba(255,255,255,0.4); margin-top:6px;">No brackets submitted to this group yet. <a href="/groups/{{ gd.group.id }}" style="color:#7eb2ff;">Add brackets â†’</a></div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>You are not in any groups yet.</p>
        {% endif %}
    </div>

    <div class="panel">
        <h3>Create Group</h3>
        <div class="row">
            <input id="createName" placeholder="Group name">
            <input id="createPass" type="password" placeholder="Password">
            <select id="createMaxBrackets" style="flex:0 0 auto; padding:10px; border-radius:8px; border:1px solid #234; background:#061633; color:#fff;">
                <option value="1">1 bracket/person</option>
                <option value="2">2 brackets/person</option>
                <option value="3">3 brackets/person</option>
                <option value="4">4 brackets/person</option>
                <option value="5">5 brackets/person</option>
            </select>
            <button id="createBtn">Create Group</button>
        </div>
    </div>

    <div class="panel">
        <h3>Join Group</h3>
        <div class="row">
            <input id="joinName" placeholder="Group name">
            <input id="joinPass" type="password" placeholder="Password">
            <button id="joinBtn">Join Group</button>
        </div>
        <div id="msg"></div>
    </div>
</div>

<script>
async function postJSON(url, payload) {
    const res = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Request failed');
    return data;
}

const msg = document.getElementById('msg');

document.getElementById('createBtn').addEventListener('click', async () => {
    try {
        const data = await postJSON('/create_group', {
            name: document.getElementById('createName').value,
            password: document.getElementById('createPass').value,
            max_brackets_per_person: parseInt(document.getElementById('createMaxBrackets').value)
        });
        window.location.href = `/groups/${data.group_id}`;
    } catch (e) {
        msg.textContent = e.message;
    }
});

document.getElementById('joinBtn').addEventListener('click', async () => {
    try {
        const data = await postJSON('/join_group', {
            name: document.getElementById('joinName').value,
            password: document.getElementById('joinPass').value
        });
        window.location.href = `/groups/${data.group_id}`;
    } catch (e) {
        msg.textContent = e.message;
    }
});
</script>
</body>
</html>