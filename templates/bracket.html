<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>March Madness Bracket</title>

    <!-- Bracket CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bracket.css') }}">
    <!-- Site-wide CSS (includes shared navbar) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">

    <!-- Bracket page overrides for the old top-bar (now replaced by site-nav) -->
    <style>
        /* Bracket controls bar sits below the navbar */
        .bracket-controls {
            background: #0033a0;
            color: white;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 3px solid #001f7a;
        }

        .bracket-controls h1 {
            margin: 0;
            font-size: 22px;
            color: #fff;
        }

        .bracket-controls .controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .bracket-controls select,
        .bracket-controls button {
            padding: 8px 14px;
            font-size: 14px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }

        .bracket-controls select {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }
        .bracket-controls select option { color: #000; }

        .bracket-controls button {
            background: #fff;
            color: #0033a0;
            font-weight: 700;
            transition: background 0.15s;
        }
        .bracket-controls button:hover { background: #e0e8ff; }

        #submitBracketButton {
            background: #f0d060;
            color: #020b1f;
        }
        #submitBracketButton:hover { background: #ffe066; }
    </style>
</head>
<body>

<!-- ========================= NAVBAR ========================= -->
<nav class="site-nav">
    <a href="/" class="nav-logo">üèÄ MM Bracket</a>
    <div class="nav-links">
        <a href="/">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </a>
        <a href="/bracket" class="active">
            <span class="nav-icon">üìã</span>
            <span class="nav-label">My Bracket</span>
        </a>
        <a href="/leaderboard">
            <span class="nav-icon">üèÜ</span>
            <span class="nav-label">Leaderboard</span>
        </a>
        {% if current_user.is_authenticated %}
        <a href="/logout" class="btn-danger">
            <span class="nav-icon">üö™</span>
            <span class="nav-label">Logout</span>
        </a>
        {% else %}
        <a href="/login">
            <span class="nav-icon">üîë</span>
            <span class="nav-label">Login</span>
        </a>
        {% endif %}
    </div>
</nav>

<!-- ========================= BRACKET CONTROLS ========================= -->
<div class="bracket-controls">
    <h1>March Madness Bracket</h1>
    <div class="controls">
        <select id="autofillStrategy">
            <option value="none">Auto-fill Strategy</option>
            <option value="simulation">Simulation (Balanced)</option>
            <option value="chalk">Chalk (Favorites)</option>
            <option value="random">Random</option>
        </select>
        <button id="autofillButton">‚ö° Auto-fill</button>
        <button id="submitBracketButton">‚úÖ Submit Bracket</button>
    </div>
</div>

<div id="bracketContainer">

    <!-- ========================= -->
    <!--        LEFT SIDE          -->
    <!-- ========================= -->
    <div class="side left-side">

        <!-- WEST REGION -->
        <div class="region">
            <h2 class="region-title">West</h2>

            <div class="round round-64">
                <h3>Round of 64</h3>
                <div class="matchups" id="west_r64">
                    <!-- JS will insert matchups here -->
                </div>
            </div>

            <div class="round round-32">
                <h3>Round of 32</h3>
                <div class="matchups" id="west_r32"></div>
            </div>

            <div class="round sweet-16">
                <h3>Sweet 16</h3>
                <div class="matchups" id="west_s16"></div>
            </div>

            <div class="round elite-8">
                <h3>Elite 8</h3>
                <div class="matchups" id="west_e8"></div>
            </div>
        </div>

        <!-- SOUTH REGION -->
        <div class="region">
            <h2 class="region-title">South</h2>

            <div class="round round-64">
                <h3>Round of 64</h3>
                <div class="matchups" id="south_r64"></div>
            </div>

            <div class="round round-32">
                <h3>Round of 32</h3>
                <div class="matchups" id="south_r32"></div>
            </div>

            <div class="round sweet-16">
                <h3>Sweet 16</h3>
                <div class="matchups" id="south_s16"></div>
            </div>

            <div class="round elite-8">
                <h3>Elite 8</h3>
                <div class="matchups" id="south_e8"></div>
            </div>
        </div>

    </div>

    <!-- ========================= -->
    <!--      FINAL FOUR AREA      -->
    <!-- ========================= -->
    <div class="final-four-area">

        <div class="final-four">
            <h2>Final Four</h2>

            <div class="matchups" id="ff_left"></div>
            <div class="matchups" id="ff_right"></div>
        </div>

        <div class="championship">
            <h2>Championship</h2>
            <div class="matchups" id="championship"></div>
        </div>

        <div class="national-champion">
            <h2>National Champion</h2>
            <div class="champion" id="champion"></div>
        </div>

    </div>

    <!-- ========================= -->
    <!--        RIGHT SIDE         -->
    <!-- ========================= -->
    <div class="side right-side">

        <!-- EAST REGION -->
        <div class="region">
            <h2 class="region-title">East</h2>

            <div class="round round-64">
                <h3>Round of 64</h3>
                <div class="matchups" id="east_r64"></div>
            </div>

            <div class="round round-32">
                <h3>Round of 32</h3>
                <div class="matchups" id="east_r32"></div>
            </div>

            <div class="round sweet-16">
                <h3>Sweet 16</h3>
                <div class="matchups" id="east_s16"></div>
            </div>

            <div class="round elite-8">
                <h3>Elite 8</h3>
                <div class="matchups" id="east_e8"></div>
            </div>
        </div>

        <!-- MIDWEST REGION -->
        <div class="region">
            <h2 class="region-title">Midwest</h2>

            <div class="round round-64">
                <h3>Round of 64</h3>
                <div class="matchups" id="midwest_r64"></div>
            </div>

            <div class="round round-32">
                <h3>Round of 32</h3>
                <div class="matchups" id="midwest_r32"></div>
            </div>

            <div class="round sweet-16">
                <h3>Sweet 16</h3>
                <div class="matchups" id="midwest_s16"></div>
            </div>

            <div class="round elite-8">
                <h3>Elite 8</h3>
                <div class="matchups" id="midwest_e8"></div>
            </div>
        </div>

    </div>

</div>

<!-- ========================= -->
<!--        JAVASCRIPT         -->
<!-- ========================= -->
<script src="{{ url_for('static', filename='js/bracket.js') }}"></script>
<script src="{{ url_for('static', filename='js/autofill.js') }}"></script>

<script>
    // Load teams on page load
    const initialTeams = {{ teams | tojson }};
    document.addEventListener("DOMContentLoaded", function () {
        loadInitialTeams(initialTeams);
    });

    // Autofill button
    document.getElementById('autofillButton').addEventListener('click', function () {
        const strat = document.getElementById('autofillStrategy').value;

        if (strat === "none") {
            alert("Choose a strategy first");
            return;
        }

        fetch("/autofill_bracket", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ strategy: strat })
        })
        .then(res => {
            if (!res.ok) throw new Error("Server error: " + res.status);
            return res.json();
        })
        .then(data => {
            autofillBracket(data);
        })
        .catch(err => {
            console.error("Autofill failed:", err);
            alert("Autofill failed. Check the console for details.");
        });
    });

    // Submit button
    document.getElementById('submitBracketButton').addEventListener('click', function () {
        const bracketData = buildBracketJSON();

        fetch("/submit_bracket", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ bracket: bracketData })
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message || data.error);
        })
        .catch(err => {
            console.error("Submit failed:", err);
            alert("Submission failed. Try again.");
        });
    });
</script>

</body>
</html>