<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ bracket.bracket_name }} ¬∑ {{ bracket.user.username }} | March Madness</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/bracket.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* ‚îÄ‚îÄ NAV DIVIDER ‚îÄ‚îÄ */
        .nav-divider {
            width: 1px; height: 18px;
            background: rgba(255,255,255,0.18);
            margin: 0 2px; flex-shrink: 0;
        }
        @media (max-width: 600px) { .nav-divider { display: none; } }

        /* ‚îÄ‚îÄ CONTROLS BAR ‚Äî same structure as bracket.html ‚îÄ‚îÄ */
        .bracket-controls {
            background: #0033a0;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 3px solid #001f7a;
            position: sticky;
            top: 64px;
            z-index: 200;
        }
        .bracket-controls-left {
            display: flex; flex-direction: column; gap: 2px;
        }
        .bracket-controls h1 {
            margin: 0;
            font-size: 22px; color: #fff;
            font-family: 'Bebas Neue', sans-serif; letter-spacing: 2px;
        }
        .bracket-byline {
            font-size: 12px; color: rgba(255,255,255,0.5);
            font-family: 'DM Sans', sans-serif;
        }
        .controls-right { display: flex; align-items: center; gap: 10px; }

        .score-pill {
            background: rgba(240,208,96,0.15);
            border: 1px solid rgba(240,208,96,0.35);
            border-radius: 20px;
            padding: 6px 18px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 22px; color: #f0d060; letter-spacing: 2px;
            white-space: nowrap;
        }
        .score-pill small {
            font-family: 'DM Sans', sans-serif; font-size: 10px;
            color: rgba(240,208,96,0.5); letter-spacing: 2px;
            text-transform: uppercase; margin-right: 6px;
        }
        .locked-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 14px;
            background: rgba(255,255,255,0.07);
            border: 1.5px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            font-size: 13px; font-weight: 600;
            color: rgba(255,255,255,0.45);
            font-family: 'DM Sans', sans-serif;
            white-space: nowrap;
        }
        .btn-back {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: rgba(255,255,255,0.85);
            font-size: 13px; font-weight: 600;
            font-family: 'DM Sans', sans-serif;
            text-decoration: none;
            transition: background 0.15s;
            white-space: nowrap;
        }
        .btn-back:hover { background: rgba(255,255,255,0.18); }

        /* Lock all interactions */
        #bracketContainer { pointer-events: none; user-select: none; }
    </style>
</head>
<body>

<!-- ========================= NAVBAR ========================= -->
<nav class="site-nav">
    <a href="/" class="nav-logo">üèÄ MM Bracket</a>
    <div class="nav-links">
        <a href="/bracket"><span class="nav-icon">‚ö°</span><span class="nav-label">Fill Bracket</span></a>
        {% if current_user.is_authenticated %}
        <a href="/my_brackets"><span class="nav-icon">üìã</span><span class="nav-label">My Brackets</span></a>
        {% endif %}
        <span class="nav-divider"></span>
        <a href="/leaderboard" class="active"><span class="nav-icon">üèÜ</span><span class="nav-label">Leaderboard</span></a>
        <a href="/rankings_stats"><span class="nav-icon">üìä</span><span class="nav-label">Rankings & Stats</span></a>
        <span class="nav-divider"></span>
        {% if current_user.is_authenticated %}
        <a href="/logout" class="btn-danger"><span class="nav-icon">üö™</span><span class="nav-label">Logout</span></a>
        {% else %}
        <a href="/login"><span class="nav-icon">üîë</span><span class="nav-label">Login</span></a>
        {% endif %}
    </div>
</nav>

<!-- ========================= CONTROLS BAR ========================= -->
<div class="bracket-controls">
    <div class="bracket-controls-left">
        <h1>{{ bracket.bracket_name }}</h1>
        <span class="bracket-byline">{{ bracket.user.username }} ¬∑ Entry {{ bracket.entry_number }}</span>
    </div>
    <div class="controls-right">
        <a href="/leaderboard" class="btn-back">‚Üê Leaderboard</a>
        <span class="locked-badge">üîí Submitted</span>
        <div class="score-pill"><small>Score</small>{{ bracket.score }}</div>
    </div>
</div>

<!-- ========================= BRACKET ========================= -->
<div id="bracketContainer">

    <div class="side left-side">
        <div class="region">
            <h2 class="region-title">West</h2>
            <div class="round round-64"><h3>Round of 64</h3><div class="matchups" id="west_r64"></div></div>
            <div class="round round-32"><h3>Round of 32</h3><div class="matchups" id="west_r32"></div></div>
            <div class="round sweet-16"><h3>Sweet 16</h3><div class="matchups" id="west_s16"></div></div>
            <div class="round elite-8"><h3>Elite 8</h3><div class="matchups" id="west_e8"></div></div>
        </div>
        <div class="region">
            <h2 class="region-title">South</h2>
            <div class="round round-64"><h3>Round of 64</h3><div class="matchups" id="south_r64"></div></div>
            <div class="round round-32"><h3>Round of 32</h3><div class="matchups" id="south_r32"></div></div>
            <div class="round sweet-16"><h3>Sweet 16</h3><div class="matchups" id="south_s16"></div></div>
            <div class="round elite-8"><h3>Elite 8</h3><div class="matchups" id="south_e8"></div></div>
        </div>
    </div>

    <div class="final-four-area">
        <div class="final-four">
            <h2>Final Four</h2>
            <div class="matchups" id="ff_left"></div>
            <div class="matchups" id="ff_right"></div>
        </div>
        <div class="championship">
            <h2>Championship</h2>
            <div class="matchups" id="championship"></div>
        </div>
        <div class="national-champion">
            <h2>National Champion</h2>
            <div class="champion" id="champion"></div>
        </div>
    </div>

    <div class="side right-side">
        <div class="region">
            <h2 class="region-title">East</h2>
            <div class="round round-64"><h3>Round of 64</h3><div class="matchups" id="east_r64"></div></div>
            <div class="round round-32"><h3>Round of 32</h3><div class="matchups" id="east_r32"></div></div>
            <div class="round sweet-16"><h3>Sweet 16</h3><div class="matchups" id="east_s16"></div></div>
            <div class="round elite-8"><h3>Elite 8</h3><div class="matchups" id="east_e8"></div></div>
        </div>
        <div class="region">
            <h2 class="region-title">Midwest</h2>
            <div class="round round-64"><h3>Round of 64</h3><div class="matchups" id="midwest_r64"></div></div>
            <div class="round round-32"><h3>Round of 32</h3><div class="matchups" id="midwest_r32"></div></div>
            <div class="round sweet-16"><h3>Sweet 16</h3><div class="matchups" id="midwest_s16"></div></div>
            <div class="round elite-8"><h3>Elite 8</h3><div class="matchups" id="midwest_e8"></div></div>
        </div>
    </div>

</div>

<!-- ========================= JS ========================= -->
<script>
const data = {{ bracket.bracket_data | tojson }};

const ROUND_ORDER = [
    ["west_r64","west_r32"],["west_r32","west_s16"],["west_s16","west_e8"],["west_e8","ff_left"],
    ["south_r64","south_r32"],["south_r32","south_s16"],["south_s16","south_e8"],["south_e8","ff_left"],
    ["east_r64","east_r32"],["east_r32","east_s16"],["east_s16","east_e8"],["east_e8","ff_right"],
    ["midwest_r64","midwest_r32"],["midwest_r32","midwest_s16"],["midwest_s16","midwest_e8"],["midwest_e8","ff_right"],
    ["ff_left","championship"],["ff_right","championship"]
];
const CONTAINERS = [
    "west_r64","west_r32","west_s16","west_e8",
    "south_r64","south_r32","south_s16","south_e8",
    "east_r64","east_r32","east_s16","east_e8",
    "midwest_r64","midwest_r32","midwest_s16","midwest_e8",
    "ff_left","ff_right","championship"
];

function render() {
    CONTAINERS.forEach(cid => {
        const teams = data[cid];
        if (!teams || !teams.length) return;

        const winners = new Set();
        ROUND_ORDER.filter(([c]) => c === cid).forEach(([, nxt]) => {
            (data[nxt] || []).forEach(t => winners.add(typeof t === 'string' ? t : t.name));
        });
        if (cid === 'championship' && data.champion) winners.add(data.champion);

        const container = document.getElementById(cid);
        if (!container) return;
        container.innerHTML = '';

        for (let i = 0; i + 1 < teams.length; i += 2) {
            const t1 = teams[i], t2 = teams[i + 1];
            const n1 = typeof t1 === 'string' ? t1 : t1.name;
            const s1 = typeof t1 === 'string' ? '' : (t1.seed || '');
            const n2 = typeof t2 === 'string' ? t2 : t2.name;
            const s2 = typeof t2 === 'string' ? '' : (t2.seed || '');
            const w1 = winners.has(n1), w2 = winners.has(n2);

            const div = document.createElement('div');
            div.className = 'matchup';
            div.innerHTML =
                `<div class="team ${w1 ? 'selected' : w2 ? 'eliminated' : ''}">
                    <span class="seed">${s1}</span><span class="team-name">${n1}</span>
                </div>` +
                `<div class="team ${w2 ? 'selected' : w1 ? 'eliminated' : ''}">
                    <span class="seed">${s2}</span><span class="team-name">${n2}</span>
                </div>`;
            container.appendChild(div);
        }

        // Stored bracket payload can include a trailing single winner per round.
        if (teams.length % 2 === 1) {
            const t = teams[teams.length - 1];
            const n = typeof t === 'string' ? t : t.name;
            const s = typeof t === 'string' ? '' : (t.seed || '');
            const w = winners.has(n);

            const div = document.createElement('div');
            div.className = 'matchup';
            div.innerHTML =
                `<div class="team ${w ? 'selected' : ''}">
                    <span class="seed">${s}</span><span class="team-name">${n}</span>
                </div>`;
            container.appendChild(div);
        }
    });

    const ch = document.getElementById('champion');
    if (ch && data.champion) ch.innerText = data.champion;
}

document.addEventListener('DOMContentLoaded', render);
</script>

</body>
</html>